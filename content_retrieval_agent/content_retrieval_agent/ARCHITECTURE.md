# ğŸ—ï¸ System Architecture

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MESSAGE GENERATION AGENT                  â”‚
â”‚                  (Your Main Application)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP REST API
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CONTENT RETRIEVAL AGENT (This System)           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   FastAPI Server                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ /search  â”‚  â”‚ /content â”‚  â”‚ /stats /health â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚            â”‚                                     â”‚
â”‚           â–¼            â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            RAG Retrieval Logic                       â”‚   â”‚
â”‚  â”‚  â€¢ Query Processing                                  â”‚   â”‚
â”‚  â”‚  â€¢ Metadata Filtering                                â”‚   â”‚
â”‚  â”‚  â€¢ Similarity Ranking                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                  â”‚                            â”‚
â”‚              â–¼                  â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Sentence        â”‚  â”‚  PostgreSQL + pgvector   â”‚        â”‚
â”‚  â”‚  Transformers    â”‚  â”‚  â€¢ Marketing Content      â”‚        â”‚
â”‚  â”‚  â€¢ Embeddings    â”‚  â”‚  â€¢ Vector Index           â”‚        â”‚
â”‚  â”‚  â€¢ 384 dims      â”‚  â”‚  â€¢ Metadata               â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagrams

### 1. Data Ingestion Flow

```
sample_data.json
    â”‚
    â”‚ 1. Read JSON
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Marketing Content â”‚
â”‚ {                 â”‚
â”‚   title: "..."    â”‚
â”‚   content: "..."  â”‚
â”‚   type: "email"   â”‚
â”‚   audience: "B2B" â”‚
â”‚ }                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 2. Generate Embedding
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sentence Transformers    â”‚
â”‚ Model: all-MiniLM-L6-v2  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 3. Output: [0.23, -0.15, 0.89, ...]
           â–¼                (384 dimensions)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL Database       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ marketing_content     â”‚ â”‚
â”‚ â”‚                       â”‚ â”‚
â”‚ â”‚ id: 1                 â”‚ â”‚
â”‚ â”‚ title: "..."          â”‚ â”‚
â”‚ â”‚ content: "..."        â”‚ â”‚
â”‚ â”‚ embedding: [...]      â”‚ â”‚
â”‚ â”‚ compliance: approved  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Search Query Flow

```
User Query: "email marketing tips for B2B"
    â”‚
    â”‚ 1. API Request
    â–¼
POST /search
{
  "query": "email marketing tips for B2B",
  "audience": "B2B",
  "top_k": 3
}
    â”‚
    â”‚ 2. Generate Query Embedding
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sentence Transformers    â”‚
â”‚ [0.12, 0.45, -0.23, ...] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 3. Vector Similarity Search
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL + pgvector           â”‚
â”‚                                 â”‚
â”‚ SELECT *                        â”‚
â”‚ FROM marketing_content          â”‚
â”‚ WHERE audience = 'B2B'          â”‚
â”‚ ORDER BY                        â”‚
â”‚   embedding <=> query_embedding â”‚
â”‚ LIMIT 3                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 4. Compute Similarity Scores
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Results with Scores               â”‚
â”‚                                   â”‚
â”‚ 1. "Email Tips..." (0.87)         â”‚
â”‚ 2. "B2B Marketing..." (0.82)      â”‚
â”‚ 3. "Campaign Guide..." (0.76)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 5. Format Response
           â–¼
JSON Response
{
  "query": "...",
  "results_count": 3,
  "results": [
    {
      "id": 1,
      "title": "...",
      "content": "...",
      "similarity_score": 0.87,
      "source": "...",
      ...
    }
  ]
}
```

## Component Architecture

### API Layer (api.py)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FastAPI Application           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Endpoints:                             â”‚
â”‚  â€¢ POST   /search          â†’ Search     â”‚
â”‚  â€¢ GET    /content/{id}    â†’ Retrieve   â”‚
â”‚  â€¢ GET    /content         â†’ List       â”‚
â”‚  â€¢ GET    /stats           â†’ Statistics â”‚
â”‚  â€¢ GET    /health          â†’ Health     â”‚
â”‚                                         â”‚
â”‚  Features:                              â”‚
â”‚  â€¢ Request Validation (Pydantic)        â”‚
â”‚  â€¢ Automatic API Docs (/docs)           â”‚
â”‚  â€¢ Error Handling                       â”‚
â”‚  â€¢ JSON Response Formatting             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Retrieval Layer (retrieval.py)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Content Retriever                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚  Methods:                                 â”‚
â”‚  â€¢ retrieve()         â†’ Semantic Search   â”‚
â”‚  â€¢ retrieve_by_id()   â†’ Direct Lookup     â”‚
â”‚  â€¢ get_all_content()  â†’ List All          â”‚
â”‚                                           â”‚
â”‚  Features:                                â”‚
â”‚  â€¢ Query Embedding Generation             â”‚
â”‚  â€¢ Metadata Filtering                     â”‚
â”‚  â€¢ Similarity Scoring                     â”‚
â”‚  â€¢ Result Ranking                         â”‚
â”‚  â€¢ Threshold Filtering                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Layer (database.py)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PostgreSQL + pgvector              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚  Table: marketing_content                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id (PK)                 INTEGER     â”‚ â”‚
â”‚  â”‚ title                   STRING      â”‚ â”‚
â”‚  â”‚ content                 TEXT        â”‚ â”‚
â”‚  â”‚ content_type            STRING      â”‚ â”‚
â”‚  â”‚ campaign_name           STRING      â”‚ â”‚
â”‚  â”‚ audience                STRING      â”‚ â”‚
â”‚  â”‚ compliance_status       STRING      â”‚ â”‚
â”‚  â”‚ source                  STRING      â”‚ â”‚
â”‚  â”‚ tags                    STRING      â”‚ â”‚
â”‚  â”‚ created_date            DATETIME    â”‚ â”‚
â”‚  â”‚ is_active               BOOLEAN     â”‚ â”‚
â”‚  â”‚ embedding               VECTOR(384) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                           â”‚
â”‚  Indexes:                                 â”‚
â”‚  â€¢ Vector index on embedding column       â”‚
â”‚  â€¢ B-tree indexes on filter columns       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Embedding Layer (embeddings.py)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Embedding Generator                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚  Model: sentence-transformers/           â”‚
â”‚         all-MiniLM-L6-v2                  â”‚
â”‚                                           â”‚
â”‚  Input:  "email marketing tips"          â”‚
â”‚  Output: [0.23, -0.15, 0.89, ..., 0.12]  â”‚
â”‚          (384 float values)               â”‚
â”‚                                           â”‚
â”‚  Features:                                â”‚
â”‚  â€¢ Fast encoding (~10ms per text)         â”‚
â”‚  â€¢ Batch processing support               â”‚
â”‚  â€¢ Cosine similarity computation          â”‚
â”‚  â€¢ Model caching in memory                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sequence Diagram: Complete Search Request

```
User          API           Retriever      Embeddings     Database
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚â”€POSTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚              â”‚             â”‚
 â”‚  /search    â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚â”€retrieve()â”€â”€â”€â”€>â”‚              â”‚             â”‚
 â”‚             â”‚   query        â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚â”€generateâ”€â”€â”€â”€>â”‚             â”‚
 â”‚             â”‚                â”‚  embedding   â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚<â”€â”€vectorâ”€â”€â”€â”€â”€â”‚             â”‚
 â”‚             â”‚                â”‚   [0.1, ...] â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚â”€vector_searchâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚             â”‚                â”‚  with filters â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚<â”€â”€resultsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚             â”‚                â”‚   (3 items)  â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚â”€computeâ”€â”€â”€â”€â”€â”€>â”‚             â”‚
 â”‚             â”‚                â”‚  similarity  â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚<â”€â”€scoresâ”€â”€â”€â”€â”€â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚             â”‚<â”€â”€formattedâ”€â”€â”€â”€â”‚              â”‚             â”‚
 â”‚             â”‚   results      â”‚              â”‚             â”‚
 â”‚             â”‚                â”‚              â”‚             â”‚
 â”‚<â”€â”€JSONâ”€â”€â”€â”€â”€â”€â”‚                â”‚              â”‚             â”‚
 â”‚  response   â”‚                â”‚              â”‚             â”‚
```

## Technology Stack Details

### Backend Framework
```
FastAPI
â”œâ”€â”€ Pydantic (Data Validation)
â”œâ”€â”€ Uvicorn (ASGI Server)
â””â”€â”€ Starlette (Web Framework)
```

### Database
```
PostgreSQL 16
â””â”€â”€ pgvector Extension
    â”œâ”€â”€ Vector Storage
    â”œâ”€â”€ Similarity Search (cosine, L2, inner product)
    â””â”€â”€ Index Support (IVFFlat, HNSW)
```

### Machine Learning
```
Sentence Transformers
â”œâ”€â”€ PyTorch Backend
â”œâ”€â”€ Pre-trained Models
â”‚   â””â”€â”€ all-MiniLM-L6-v2
â”‚       â”œâ”€â”€ Size: ~80MB
â”‚       â”œâ”€â”€ Dimensions: 384
â”‚       â””â”€â”€ Speed: ~10ms/text
â””â”€â”€ Similarity Functions
```

## Deployment Architecture

### Local Development
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Developer      â”‚
â”‚   Machine        â”‚
â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Python API â”‚  â”‚
â”‚  â”‚ :8000      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL â”‚  â”‚
â”‚  â”‚ :5432      â”‚  â”‚
â”‚  â”‚ (Docker)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production (Example)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Load Balancer                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Server  â”‚    â”‚  API Server  â”‚
â”‚  (Container) â”‚    â”‚  (Container) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL + pgvector      â”‚
â”‚  (Managed Database)         â”‚
â”‚  â€¢ Read Replicas            â”‚
â”‚  â€¢ Auto Backup              â”‚
â”‚  â€¢ High Availability        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Security Layers               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  1. API Layer                         â”‚
â”‚     â€¢ Authentication (OAuth2, JWT)    â”‚
â”‚     â€¢ Rate Limiting                   â”‚
â”‚     â€¢ Input Validation                â”‚
â”‚     â€¢ CORS Configuration              â”‚
â”‚                                       â”‚
â”‚  2. Application Layer                 â”‚
â”‚     â€¢ SQL Injection Prevention        â”‚
â”‚     â€¢ XSS Protection                  â”‚
â”‚     â€¢ CSRF Tokens                     â”‚
â”‚                                       â”‚
â”‚  3. Database Layer                    â”‚
â”‚     â€¢ Encrypted Connections (SSL/TLS) â”‚
â”‚     â€¢ Role-Based Access Control       â”‚
â”‚     â€¢ Query Parameterization          â”‚
â”‚                                       â”‚
â”‚  4. Infrastructure Layer              â”‚
â”‚     â€¢ Network Isolation               â”‚
â”‚     â€¢ Firewall Rules                  â”‚
â”‚     â€¢ Encrypted Storage               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Characteristics

### Latency Breakdown
```
Total Search Request: ~100ms
â”œâ”€â”€ API Processing: ~5ms
â”œâ”€â”€ Embedding Generation: ~10ms
â”œâ”€â”€ Database Query: ~30ms
â”‚   â”œâ”€â”€ Vector Search: ~20ms
â”‚   â””â”€â”€ Metadata Filtering: ~10ms
â”œâ”€â”€ Result Processing: ~5ms
â””â”€â”€ Response Formatting: ~5ms
```

### Scalability Limits
```
Single Instance:
â”œâ”€â”€ Concurrent Requests: ~1000 req/s
â”œâ”€â”€ Content Items: 100,000+ (sub-second search)
â”œâ”€â”€ Memory Usage: ~500MB (model loaded)
â””â”€â”€ Storage: ~1GB per 100k items

Horizontal Scaling:
â”œâ”€â”€ Load Balanced API Servers
â”œâ”€â”€ Read Replicas for Database
â”œâ”€â”€ Cache Layer (Redis) for hot queries
â””â”€â”€ CDN for static content
```

## Data Privacy & Compliance

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Compliance Features              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  â€¢ compliance_status field            â”‚
â”‚    - Only approved content served     â”‚
â”‚    - Audit trail of approvals         â”‚
â”‚                                       â”‚
â”‚  â€¢ Source attribution                 â”‚
â”‚    - Track content origin             â”‚
â”‚    - Campaign associations            â”‚
â”‚                                       â”‚
â”‚  â€¢ Data retention policies            â”‚
â”‚    - is_active flag for soft delete   â”‚
â”‚    - created_date for age tracking    â”‚
â”‚                                       â”‚
â”‚  â€¢ Access control ready               â”‚
â”‚    - User permissions (extensible)    â”‚
â”‚    - Role-based access                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Integration Patterns

### Pattern 1: Synchronous Request
```
Message Gen Agent â†’ [REST API] â†’ Content Retrieval Agent
                  â† [JSON]     â†
```

### Pattern 2: Batch Processing
```
Batch Job â†’ [Multiple Queries] â†’ Content Retrieval Agent
          â† [Aggregated Results] â†
```

### Pattern 3: Event-Driven
```
New Content â†’ Event Bus â†’ Content Retrieval Agent
                        â†’ Auto-Index â†’ Database
```

---

**This architecture provides a scalable, maintainable, and production-ready content retrieval system.**
